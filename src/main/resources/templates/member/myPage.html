<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>메가박스 :: 마이페이지</title>
    <th:block th:replace="~{fragments/head :: common}"></th:block>
    <link rel="stylesheet" th:href="@{/member/stylesheets/myPage.css}">
    <script src="https://kit.fontawesome.com/282afddd53.js" crossorigin="anonymous"></script>
    <script defer th:src="@{/member/scripts/myPage.js}"></script>
</head>
<body>
<th:block th:replace="~{fragments/body :: header}"></th:block>
<div class="page-util" id="pageUtil">
    <div class="inner-wrap">
        <div class="location">
            <a th:href="@{/}">Home</a>
            <a th:href="@{./myPage}">나의 메가박스</a>
        </div>
    </div>
</div>
<div class="container" id="container">
    <div class="inner-wrap">
        <input type="hidden" th:value="${session.user.getId}" rel="id">
        <input type="hidden" th:value="${session.user.getPassword}" rel="password">
        <div class="side-menu">
            <nav>
                <p class="title">
                    <a th:href="@{./myPage}">나의 메가박스</a>
                </p>
                <ul>
                    <li>
                        <a href="#">예매/구매내역</a>
                        <ul class="member-info">
                            <li>
                                <a href="#">예매내역</a>
                                <a href="#">구매내역</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#">회원정보</a>
                        <ul class="member-info">
                            <li>
                                <a th:href="@{./modify}">개인정보 수정</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="#" rel="aa">영화/스토어 관람권</a>
                    </li>
                    <li>
                        <a href="#">메가박스/제휴쿠폰</a>
                    </li>
                    <li>
                        <a href="#">멤버십 포인트</a>
                    </li>
                    <li>
                        <a href="#">자주쓰는 카드 관리</a>
                    </li>
                    <li>
                        <a href="#">나의 문의내역</a>
                    </li>
                </ul>
            </nav>
        </div>
        <div class="contents">
            <div class="myPage-main">
                <div class="myPage-info">
                    <div class="top">
                        <div class="profile-image">
                            <div class="image-wrap">
                                <img src="https://img.megabox.co.kr/static/pc/images/mypage/bg-photo.png" alt="">
                            </div>
                        </div>
                        <div class="grade">
                            <p class="name">
                                <span th:text="${session.user.getName()}"></span>님은<br>일반등급입니다.
                            </p>
                            <div class="link-modify">
                                <a th:href="@{./modify}">개인정보 수정</a>
                                <i class="fa-solid fa-angle-right"></i>
                            </div>
                        </div>
                    </div>
                    <div class="bottom">
                        <div class="point">
                            <div class="title-area">
                                <p class="title">총 보유 포인트</p>
                                <i></i>
                            </div>
                            <div class="point-area">
                                <div class="total-point">
                                    <p th:text="${point} + 'P'">0P</p>
                                </div>
                            </div>
                            <div class="change">
                                <p class="save">
                                    <span>적립예정</span>
                                    <em>0P</em>
                                </p>
                                <p class="delete">
                                    <span>소멸예정</span>
                                    <em>0P</em>
                                </p>
                            </div>
                        </div>
                        <div class="recent-visit">
                            <div class="title-area">
                                <p class="title">최근 방문 극장</p>
                            </div>
                            <div class="list">
                                <li th:each="bookingKey, index : ${sortedBookingMapKeySet}"
                                    th:if="${index.index} < 3"
                                    th:with="bookingList = ${bookingMap.get(bookingKey)}"
                                    th:text="${bookingList.get(0).getBranchText()}">
                                </li>
<!--                                <li>북대구(칠곡)</li>-->
<!--                                <li>경산하양</li>-->
<!--                                <li>동대구(신세계)</li>-->
                            </div>
                        </div>
                        <div class="coupon">
                            <div class="title-area">
                                <p class="title">관람권/쿠폰</p>
                            </div>
                            <div class="list">
                                <li>
                                    <span>영화관람권</span>
                                    <em>0매</em>
                                </li>
                                <li>
                                    <span>스토어교환권</span>
                                    <em>0매</em>
                                </li>
                                <li>
                                    <span>할인/제휴쿠폰</span>
                                    <em>0매</em>
                                </li>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="myBook">
                    <div class="book-title">
                        <h2 class="title">나의 예매내역</h2>
                        <a href="#" class="more">더보기
                            <i class="fa-solid fa-angle-right"></i>
                        </a>
                    </div>
                    <div class="book-history">
                        <ul>
                            <li class="no-result" th:if="${bookingHistories.length == 0}">
                                <div>예매 내역이 없습니다.</div>
                            </li>
<!--                            <li th:each="bookingKey : ${bookingMap.keySet().stream().sorted(T(java.util.Comparator).reverseOrder()).toArray()}"-->
<!--                                th:with="bookingList = ${bookingMap.get(bookingKey)}">-->
                            <li th:each="bookingKey : ${sortedBookingMapKeySet}"
                                th:with="bookingList = ${bookingMap.get(bookingKey)}">
                                <input type="hidden" th:value="${session.user.getId()}" rel="hiddenUserId">
                                <input type="hidden" th:value="${bookingList.get(0).getScreenInfoIndex()}" rel="hiddenSid">
                                <p class="img">
                                    <img alt="" th:src="${bookingList.get(0).getMoviePoster()}">
                                </p>
                                <div class="cont">
                                    <p class="ticket">
                                        예매 번호 :
                                        <em th:text="${bookingList.get(0).getIndex()}">1234-123-12345</em>
                                    </p>
                                    <div>
                                        <p th:text="${bookingList.get(0).getTitle()}">아바타: 물의 길/2D(자막)</p>
                                        <p class="theater"
                                           th:text="${bookingList.get(0).getBranchText()} + ' / ' + ${bookingList.get(0).getAuditoriumText()}">
                                            북대구(칠곡)/6관</p>
                                    </div>
                                    <p rel="seatContainer">
                                        <span hidden rel="seat"
                                              th:each="bookingVo : ${bookingList}"
                                              th:data-payment="${bookingVo.getPayment()}"
                                              th:data-seat="${bookingVo.getColumnText() + bookingVo.getRow()}">
                                        </span>
                                    </p>
                                    <p class="date"
                                       th:text="${#dates.format(bookingList.get(0).getScreenDate(), 'yyyy.MM.dd')} + ' (' + ${bookingList.get(0).getDayOfWeek()} + ') ' + ${#dates.format(bookingList.get(0).getMvStartTime(), 'HH:mm')}">
                                        2023.01.10 (화) 20:30</p>
                                </div>
                                <div class="cancel">
                                    <button class="book-cancel">예매취소</button>
                                </div>
                            </li>
                            <!--                            <li th:each="bookingHistory : ${bookingHistories}">-->
                            <!--                                <p class="img">-->
                            <!--                                    <img alt="" th:src="${bookingHistory.getMoviePoster()}">-->
                            <!--                                </p>-->
                            <!--                                <div class="cont">-->
                            <!--                                    <p class="ticket">-->
                            <!--                                        예매 번호 :-->
                            <!--                                        <em th:text="${bookingHistory.getIndex}">1234-123-12345</em>-->
                            <!--                                    </p>-->
                            <!--                                    <p th:text="${bookingHistory.getTitle}">아바타: 물의 길/2D(자막)</p>-->
                            <!--                                    <p class="theater"-->
                            <!--                                       th:text="${bookingHistory.getBranchText()} + ' / ' + ${bookingHistory.getAuditoriumText()}">-->
                            <!--                                        북대구(칠곡)/6관</p>-->
                            <!--                                    <p>성인1-->
                            <!--                                        <span>좌석 :-->
                            <!--                                        <em th:text="${bookingHistory.getColumnText} + ${bookingHistory.getRow()}">E5</em>-->
                            <!--                                    </span>-->
                            <!--                                    </p>-->
                            <!--                                    <p class="date" th:text="${#dates.format(bookingHistory.getScreenDate(), 'yyyy.MM.dd')} + ' (' + ${bookingHistory.getDayOfWeek()} + ') ' + ${#dates.format(bookingHistory.getMvStartTime(), 'HH:mm')}">2023.01.10 (화) 20:30</p>-->
                            <!--                                </div>-->
                            <!--                                <div class="cancel">-->
                            <!--                                    <button class="book-cancel">예매취소</button>-->
                            <!--                                </div>-->
                            <!--                            </li>-->
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<th:block th:replace="~{fragments/body :: footer}"></th:block>
</html>